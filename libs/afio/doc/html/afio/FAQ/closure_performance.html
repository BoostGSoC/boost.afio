<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
<title>What is the maximum throughput of AFIO's closure execution engine aka how many IOPS can I push with AFIO?</title>
<link rel="stylesheet" href="../../myboostbook.css" type="text/css">
<meta name="generator" content="DocBook XSL Stylesheets V1.78.1">
<link rel="home" href="../../index.html" title="Chapter&#160;1.&#160;Boost.AFIO 1.1">
<link rel="up" href="../FAQ.html" title="Frequently Asked Questions">
<link rel="prev" href="../FAQ.html" title="Frequently Asked Questions">
<link rel="next" href="stuck_ops.html" title="I'm seeing &#8220;WARNING: ~async_file_dispatcher_base() detects stuck async_io_op in total of X ops&#8221; during process close. What does this mean?">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<table cellpadding="2" width="100%"><tr>
<td valign="top"><img alt="Boost C++ Libraries" width="277" height="86" src="../../../../boost.png"></td>
<td align="center"><a href="../../../../index.html">Home</a></td>
<td align="center"><a href="../../../../libs/libraries.htm">Libraries</a></td>
<td align="center"><a href="http://www.boost.org/users/people.html">People</a></td>
<td align="center"><a href="http://www.boost.org/users/faq.html">FAQ</a></td>
<td align="center"><a href="../../../../more/index.htm">More</a></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../FAQ.html"><img src="../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../FAQ.html"><img src="../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="stuck_ops.html"><img src="../../../../doc/src/images/next.png" alt="Next"></a>
</div>
<div class="section">
<div class="titlepage"><div><div><h3 class="title">
<a name="afio.FAQ.closure_performance"></a><a class="link" href="closure_performance.html" title="What is the maximum throughput of AFIO's closure execution engine aka how many IOPS can I push with AFIO?">What is the maximum throughput
      of AFIO's closure execution engine aka how many IOPS can I push with AFIO?</a>
</h3></div></div></div>
<p>
        For v1.1, maximum ops <span class="bold"><strong>dispatch</strong></span> throughput
        is approximately as follows, where the values for <code class="computeroutput"><span class="identifier">call</span><span class="special">()</span></code> might be for use as a closure engine whereas
        the values for <code class="computeroutput"><span class="identifier">completion</span><span class="special">()</span></code> might be for max filing system IOPS:
      </p>
<div class="table">
<a name="afio.FAQ.closure_performance.throughput"></a><p class="title"><b>Table&#160;1.8.&#160;Maximum null closure dispatch rate on a 3.5Ghz Intel Core i7 3770K
        for AFIO v1.1:</b></p>
<div class="table-contents"><table class="table" summary="Maximum null closure dispatch rate on a 3.5Ghz Intel Core i7 3770K
        for AFIO v1.1:">
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Operating system
                </p>
              </th>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">call</span><span class="special">()</span></code>
                  unchained
                </p>
              </th>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">call</span><span class="special">()</span></code>
                  chained
                </p>
              </th>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">completion</span><span class="special">()</span></code>
                  unchained
                </p>
              </th>
<th>
                <p>
                  <code class="computeroutput"><span class="identifier">completion</span><span class="special">()</span></code>
                  chained
                </p>
              </th>
<th>
                <p>
                  Raw ASIO
                </p>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  Microsoft Windows 8 x64 with Visual Studio 2013
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">200752</span>
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">136738</span>
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">420108</span>
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">352845</span>
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">2806070</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  Ubuntu 12.04 LTS Linux x64 with GCC 4.8
                </p>
              </td>
<td>
              </td>
<td>
              </td>
<td>
              </td>
<td>
              </td>
<td>
              </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
        While this is fast enough for consumer SSDs (which is the whole point of
        AFIO), and we would emphasise that scaling where the closures are doing real
        i/o work is close to linear thanks to careful use of no worse than O(N) algorithms
        throughout, we agree AFIO's performance is currently not great for less heavyweight
        closures. The biggest limiter, by far, is the mutex protecting the ops dispatch
        and completion implementation. Because AFIO is pure batch, dispatch is very
        rarely a problem: rather it is completion, because completion handling must
        always be performed per op completion in order to check for and dispatch,
        if necessary, dependencies. Currently the top consumers of CPU time during
        null closure dispatch benchmarks are as follows:
      </p>
<div class="table">
<a name="afio.FAQ.closure_performance.top_consumers"></a><p class="title"><b>Table&#160;1.9.&#160;Top consumers of CPU time during null closure dispatch in AFIO v1.1
        on Microsoft Windows</b></p>
<div class="table-contents"><table class="table" summary="Top consumers of CPU time during null closure dispatch in AFIO v1.1
        on Microsoft Windows">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>
                <p>
                  Unchained
                </p>
              </th>
<th>
              </th>
<th>
                <p>
                  Chained
                </p>
              </th>
<th>
              </th>
</tr></thead>
<tbody>
<tr>
<td>
                <p>
                  ops spinlock
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">71%</span>
                </p>
              </td>
<td>
                <p>
                  ops spinlock
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">71%</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  threadpool waiting for new ops
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">7.4%</span>
                </p>
              </td>
<td>
                <p>
                  threadpool waiting for new ops
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">8.2%</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  memory allocator
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">3.4%</span>
                </p>
              </td>
<td>
                <p>
                  memory allocator
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">1.9%</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  sending ops to threadpool
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">1.5%</span>
                </p>
              </td>
<td>
                <p>
                  sending ops to threadpool
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">1.1%</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  RtlUserThreadStart
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">10%</span>
                </p>
              </td>
<td>
                <p>
                  RtlUserThreadStart
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">10%</span>
                </p>
              </td>
</tr>
<tr>
<td>
                <p>
                  remainder and misc
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">6.7%</span>
                </p>
              </td>
<td>
                <p>
                  remainder and misc
                </p>
              </td>
<td>
                <p>
                  <span class="alignright">7.8%</span>
                </p>
              </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>
        As you can see, when the closures do no real work, one spends a huge amount
        of time contending the ops lock. Luckily, the ops lock is not held while
        file i/o operations or closures are being executed, so contention on the
        ops lock isn't as much of a problem during real world use i.e. you will get
        a significant amount of <span class="quote">&#8220;<span class="quote">free</span>&#8221;</span> file i/o without losing much
        in maximum op dispatch throughput.
      </p>
</div>
<table xmlns:rev="http://www.cs.rpi.edu/~gregod/boost/tools/doc/revision" width="100%"><tr>
<td align="left"></td>
<td align="right"><div class="copyright-footer">Copyright &#169; 2013 Niall Douglas and Paul Kirth<p>
        Distributed under the Boost Software License, Version 1.0. (See accompanying
        file LICENSE_1_0.txt or copy at <a href="http://www.boost.org/LICENSE_1_0.txt" target="_top">http://www.boost.org/LICENSE_1_0.txt</a>)
      </p>
</div></td>
</tr></table>
<hr>
<div class="spirit-nav">
<a accesskey="p" href="../FAQ.html"><img src="../../../../doc/src/images/prev.png" alt="Prev"></a><a accesskey="u" href="../FAQ.html"><img src="../../../../doc/src/images/up.png" alt="Up"></a><a accesskey="h" href="../../index.html"><img src="../../../../doc/src/images/home.png" alt="Home"></a><a accesskey="n" href="stuck_ops.html"><img src="../../../../doc/src/images/next.png" alt="Next"></a>
</div>
</body>
</html>
